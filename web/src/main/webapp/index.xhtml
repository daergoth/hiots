<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:p="http://primefaces.org/ui" template="/template/base.xhtml">
	<ui:define name="content">

		<h:form id="form">

			<p:layout id="dashboard" style="min-height: 500px;">

				<p:layoutUnit id="centerUnit" position="center" size="80%">
					<p:dashboard id="board" binding="#{indexManager.dashboard}">
						<p:ajax event="reorder" listener="#{indexManager.handleReorder}" />
					</p:dashboard>
					<div style="clear: both" />
				</p:layoutUnit>

				<p:layoutUnit id="eastUnit" position="east" resizable="false"
					size="20%" style="text-align: center;">
					<p:outputLabel value="Current layout:" />

					<p:selectOneMenu id="currentLayout"
						value="#{indexManager.selectedLayout}"
						style="width: 80%; margin-bottom: 10px;">

						<f:selectItem itemLabel="Select One" itemValue=""
							noSelectionOption="true" />
						<f:selectItems id="selectItems" value="#{indexManager.layouts}"
							var="layout" itemLabel="#{layout.name}" itemValue="#{layout}" />
							
						<f:converter binding="#{overviewLayoutConverter}" />

						<p:ajax event="change" listener="#{indexManager.layoutChanged}" />

					</p:selectOneMenu>

					<p:menu style="width: 99%;">
						<p:submenu label="Layout">
							<p:menuitem id="newLayout" value="New"
								onclick="PF('newLayoutOverlay').show();" icon="fa fa-plus" />
							<p:menuitem id="renameLayout" value="Rename"
								onclick="PF('renameLayoutOverlay').show('#{component.clientId}');"
								icon="fa fa-edit" />
							<p:menuitem id="removeLayout" value="Remove"
								onclick="PF('removeLayoutOverlay').show('#{component.clientId}');"
								icon="fa fa-remove" />
						</p:submenu>
						<p:submenu label="New sensor widget">
							<p:menuitem id="newTempWidget" value="Temperature"
								onclick="PF('newTempOverlay').show('#{component.clientId}');"
								icon="fa fa-plus" />
							<p:menuitem id="newLightWidget" value="Light "
								onclick="PF('newLightOverlay').show('#{component.clientId}');"
								icon="fa fa-plus" />
						</p:submenu>
					</p:menu>

				</p:layoutUnit>


			</p:layout>


			<p:dialog widgetVar="newTempOverlay" resizable="false">
				<ui:repeat var="sensor"
					value="#{indexManager.getSensorByType('Temperature')}">
					<p:commandButton value="#{sensor.name}"
						actionListener="#{indexManager.newTemperatureWidget(sensor.id)}" update="form:board"/>
				</ui:repeat>
			</p:dialog>

			<p:dialog widgetVar="newLightOverlay" resizable="false">
				<ui:repeat var="sensor"
					value="#{indexManager.getSensorByType('Light')}">
					<p:commandButton value="#{sensor.name}"
						actionListener="#{indexManager.newLightWidget(sensor.id)}" />
				</ui:repeat>
			</p:dialog>
			
			<p:poll interval="2" listener="#{indexManager.refresh}" update="form:board"/>
			
		</h:form>
		<h:form id="layoutForm">
			<p:dialog id="newLayoutOverlay" widgetVar="newLayoutOverlay"
				header="New layout" resizable="false">
				<p:outputLabel value="Name:" />
				<p:inputText value="#{indexManager.newLayoutName}" />
				<p:commandButton value="Create" action="#{indexManager.newLayout}"
					update="form:currentLayout" />
			</p:dialog>
		</h:form>
		<h:form>
			<p:dialog widgetVar="renameLayoutOverlay" header="Rename layout"
				resizable="false">
				<p:outputLabel value="New Name:" />
				<p:inputText value="#{indexManager.renameLayoutName}" />
				<p:commandButton value="Rename"
					action="#{indexManager.renameLayout}" update="form:currentLayout" />
			</p:dialog>
		</h:form>
		<h:form>
			<p:dialog widgetVar="removeLayoutOverlay" header="Are you sure?"
				resizable="false">
				<p:commandButton value="Yes"
					actionListener="#{indexManager.removeLayout}"
					onclick="PF('removeLayoutOverlay').hide();" update="form:dashboard" />
				<p:commandButton value="No"
					onclick="PF('removeLayoutOverlay').hide();" />
			</p:dialog>
		</h:form>
	</ui:define>
</ui:composition>
